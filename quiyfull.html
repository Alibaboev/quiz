<!DOCTYPE html>
<html lang="uk" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI-—Ç–µ—Å—Ç –∑ –ø—Ä–æ—Ñ–æ—Ä—ñ—î–Ω—Ç–∞—Ü—ñ—ó | MedStudy.cz (–§—ñ–Ω–∞–ª—å–Ω–∞ –≤–µ—Ä—Å—ñ—è)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>
  <!-- 
    NOTE FOR DEVELOPER:
    This is the final combined version. It uses the advanced UI from the user's prototype 
    and loads all content (questions, prompts) from external `questions.json` and `prompts.json` files.
    For this demo to work, the JSON files must be in the same folder as this HTML file,
    and it must be run through a local web server (e.g., VS Code Live Server) due to fetch() limitations.
  -->
  <style>
    body{font-family:'Inter',sans-serif;background:#fff;color:#7A8899}
    .page_main{display:flex;flex-direction:column;justify-content:center;align-items:center;padding:1rem;min-height:100vh;width:100%}
    @media (min-width:701px){.page_main{padding:2rem}}
    .quiz-container{background:#fff;padding:2rem;border-radius:12px;box-shadow:0 0 30px 0 rgba(0,0,0,.07),0 30px 60px 0 rgba(0,0,0,.12);width:100%;max-width:640px;text-align:center;border:1px solid #e5e7eb}
    h1,h2{color:#153060;line-height:1.3}
    h1{font-size:28px;font-weight:700}
    h2{font-size:22px;font-weight:600}
    @media (min-width:768px){h1{font-size:42px}h2{font-size:28px}}
    .btn{padding:14px 24px;border-radius:8px;font-weight:600;transition:.2s;cursor:pointer;display:inline-block;text-align:center;border:1px solid transparent}
    .btn:disabled{background:#d1d5db;cursor:not-allowed}
    .btn-primary{background:#153060;color:#fff}
    .btn-primary:hover:not(:disabled){background:#00C0FD}
    .btn-secondary{background:transparent;color:#153060;border:2px solid #153060}
    .btn-secondary:hover{background:#153060;color:#fff}
    .loader{border:4px solid #e5e7eb;border-top:4px solid #153060;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;margin:20px auto}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    .progress-bar-container{width:100%;background:#e5e7eb;border-radius:9999px;height:8px;margin-bottom:.5rem}
    .progress-bar-inner{background:#00C0FD;height:100%;border-radius:9999px;transition:width .3s ease-in-out}
    .quiz-option{width:100%;padding:1rem;border:2px solid #e5e7eb;border-radius:8px;text-align:left;transition:.2s;font-weight:500;color:#153060}
    .quiz-option:hover,.quiz-option:focus{background:#F6F8FA;border-color:#00C0FD;outline:none}
    .form-input,.open-question-textarea{width:100%;padding:12px;border:1px solid #dcdcdc;border-radius:4px;font-size:1rem;resize:vertical}
    .form-input:focus,.open-question-textarea:focus{outline:none;border-color:#153060;box-shadow:0 0 0 2px rgba(21,48,96,.2)}
    .input-hint{font-size:0.875rem;color:#ef4444;text-align:left;margin-top:0.5rem;}
    .preview-wrap{position:relative;border:1px solid #e5e7eb;border-radius:10px;overflow:hidden;background:#f8fafc}
    .preview-content{padding:14px;filter:blur(3px)}
    .preview-wrap::after{content:"";position:absolute;left:0;right:0;bottom:0;height:56px;background:linear-gradient(to top, rgba(255,255,255,0.96), rgba(255,255,255,0))}
    .preview-label{position:absolute;bottom:8px;right:12px;font-size:12px;color:#64748b;background:#fff;padding:4px 8px;border-radius:6px;border:1px solid #e5e7eb}
  </style>
</head>
<body class="flex flex-col min-h-screen">
  <header class="bg-white">
    <div class="container mx-auto px-6 py-4 flex justify-center items-center max-w-6xl">
      <a href="#" class="text-2xl font-bold" style="color:#153060">MedStudy.cz</a>
    </div>
  </header>

  <main class="page_main">
    <div class="quiz-container">
      <div id="app-loader" class="loader"></div>
      
      <!-- Screen 1: Start View -->
      <div id="start-container" class="hidden">
        <h1 class="mb-4">üéØ –û–±–µ—Ä–∏ –ø—Ä–æ—Ñ–µ—Å—ñ—é —Ç–∞ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç –º—Ä—ñ—ó –≤ –ß–µ—Ö—ñ—ó ‚Äî –∑–∞ 5 —Ö–≤–∏–ª–∏–Ω</h1>
        <p class="mb-8">–í—ñ–¥–ø–æ–≤—ñ–¥–∞–π –Ω–∞ 3 –ø—Ä–æ—Å—Ç–∏—Ö –∑–∞–ø–∏—Ç–∞–Ω–Ω—è ‚Äî —ñ –æ—Ç—Ä–∏–º–∞–π –ø—ñ–¥–±—ñ—Ä–∫—É —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—Å—Ç–µ–π —Ç–∞ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—ñ–≤, —è–∫—ñ –ø—ñ–¥—ñ–π–¥—É—Ç—å —Å–∞–º–µ —Ç–æ–±—ñ. –ë—ñ–ª—å—à–µ 1000 –∞–±—ñ—Ç—É—Ä—ñ—î–Ω—Ç—ñ–≤ –≤–∂–µ –∑–Ω–∞–π—à–ª–∏ —Å–≤—ñ–π —à–ª—è—Ö –∑ –Ω–∞—à–∏–º AI-—Ç–µ—Å—Ç–æ–º.</p>
        <button id="start-test-btn" class="btn btn-primary w-full sm:w-auto text-lg">–†–æ–∑–ø–æ—á–∞—Ç–∏ —Ç–µ—Å—Ç</button>
      </div>

      <!-- Screen 2: Role Selection View -->
      <div id="role-selection-container" class="hidden">
        <h2 class="mb-6">–•—Ç–æ –∑–∞—Ä–∞–∑ –ø—Ä–æ—Ö–æ–¥–∏—Ç—å —Ç–µ—Å—Ç?</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <button class="quiz-option text-center p-6" data-role="student">
            <span class="text-3xl">üéì</span>
            <span class="block mt-2 font-bold">–Ø ‚Äî —É—á–µ–Ω—å/—Å—Ç—É–¥–µ–Ω—Ç</span>
          </button>
          <button class="quiz-option text-center p-6" data-role="parent">
            <span class="text-3xl">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</span>
            <span class="block mt-2 font-bold">–Ø ‚Äî –æ–¥–∏–Ω –∑ –±–∞—Ç—å–∫—ñ–≤</span>
          </button>
        </div>
      </div>

      <!-- Screen 3: Education Level Selection View -->
      <div id="education-level-container" class="hidden">
        <h2 class="mb-6">–í–∞—Å —Ü—ñ–∫–∞–≤–∏—Ç—å –≤—Å—Ç—É–ø –ø—ñ—Å–ª—è:</h2>
        <div class="grid grid-cols-1 gap-4">
          <button class="quiz-option" data-level="grade_9">9 –∫–ª–∞—Å—É</button>
          <button class="quiz-option" data-level="grade_11">11 –∫–ª–∞—Å—É</button>
          <button class="quiz-option" data-level="bachelor">–±–∞–∫–∞–ª–∞–≤—Ä–∞—Ç—É</button>
          <button class="quiz-option" data-level="undecided">—â–µ –Ω–µ –≤–∏–∑–Ω–∞—á–∏–≤—Å—è</button>
        </div>
      </div>

      <!-- Screen 4: Language Selection View -->
      <div id="language-selection-container" class="hidden">
        <h2 class="mb-6">–Ø–∫–∞ –º–æ–≤–∞ –Ω–∞–≤—á–∞–Ω–Ω—è –≤–∞–º –±–ª–∏–∂—á–∞?</h2>
        <div class="grid grid-cols-1 gap-4">
            <button class="quiz-option" data-lang="czech">–ß–µ—Å—å–∫–∞</button>
            <button class="quiz-option" data-lang="english">–ê–Ω–≥–ª—ñ–π—Å—å–∫–∞</button>
            <button class="quiz-option" data-lang="both">–û–±–∏–¥–≤—ñ</button>
            <button class="quiz-option" data-lang="undecided">–©–µ –Ω–µ –∑–Ω–∞—é</button>
        </div>
      </div>

      <!-- Screen 5: Quiz View -->
      <div id="quiz-container" class="hidden">
        <div class="sticky top-0 z-10 bg-white pb-2 -mt-4 pt-4">
          <div class="progress-bar-container"><div id="progress-bar" class="progress-bar-inner" style="width:0%"></div></div>
          <p id="progress-text" class="text-sm text-gray-500 mb-4"></p>
        </div>
        <div id="question-container" class="mb-6">
          <h2 id="question-text" class="text-xl sm:text-2xl font-semibold text-center mb-6"></h2>
          <div id="options-container" class="grid grid-cols-1 gap-4"></div>
        </div>
        <button id="next-question-btn" class="btn btn-primary w-full sm:w-auto hidden" disabled>–î–∞–ª—ñ</button>
      </div>

      <!-- Screen 6: Lead Capture View -->
      <div id="lead-capture-container" class="hidden">
        <h2 class="mb-4">–¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω–æ!</h2>
        <p class="mb-4">–í–∞—à AI-–∑–≤—ñ—Ç –º–∞–π–∂–µ –≥–æ—Ç–æ–≤–∏–π. –û—Ç—Ä–∏–º–∞–π—Ç–µ –ø—ñ–¥–±—ñ—Ä–∫—É —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—Å—Ç–µ–π —ñ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—ñ–≤ —Å–∞–º–µ –¥–ª—è –≤–∞—Å.</p>
        <div class="preview-wrap mb-4 hidden" id="preview-wrap">
          <div id="results-preview" class="preview-content text-left text-gray-700"></div>
          <span class="preview-label">–ü–æ–≤–Ω–∏–π –∑–≤—ñ—Ç –Ω–∞–¥—ñ—à–ª–µ–º–æ –Ω–∞ –ø–æ—à—Ç—É</span>
        </div>
        <form id="lead-form" class="text-left">
          <div class="mb-4">
            <label for="lead-name" class="block font-semibold mb-2 text-gray-700">–í–∞—à–µ —ñ–º'—è <span class="text-red-500">*</span></label>
            <input type="text" id="lead-name" class="form-input" required />
          </div>
          <div class="mb-4">
            <label for="lead-email" class="block font-semibold mb-2 text-gray-700">Email –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ <span class="text-red-500">*</span></label>
            <input type="email" id="lead-email" class="form-input" required />
          </div>
          <div class="mb-4">
            <label for="lead-phone" class="block font-semibold mb-2 text-gray-700">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É</label>
            <input type="tel" id="lead-phone" class="form-input" placeholder="+420 123 456 789" />
          </div>
          <div class="mb-6">
            <label for="lead-social" class="block font-semibold mb-2 text-gray-700">–ö–æ–Ω—Ç–∞–∫—Ç —É —Å–æ—Ü–º–µ—Ä–µ–∂–∞—Ö (Telegram, Instagram)</label>
            <input type="text" id="lead-social" class="form-input" placeholder="@your_nickname" />
          </div>
          <button type="submit" id="submit-lead-btn" class="btn btn-primary w-full text-lg">–û—Ç—Ä–∏–º–∞—Ç–∏ –∑–≤—ñ—Ç</button>
          <div id="form-loader" class="loader hidden"></div>
          <p id="form-error" class="text-red-500 text-center mt-4 hidden"></p>
        </form>
      </div>

      <!-- Screen 7: Thank You View -->
      <div id="thank-you-container" class="hidden">
        <div class="text-5xl mb-4">üéâ</div>
        <h2 class="mb-4">–î—è–∫—É—î–º–æ!</h2>
        <p class="mb-2">–í–∞—à—ñ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –≤–∂–µ –ª–µ—Ç—è—Ç—å –Ω–∞ –ø–æ—à—Ç—É! –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–∞–ø–∫—É "–í—Ö—ñ–¥–Ω—ñ".</p>
        <p class="font-semibold mb-4">–ê –ø–æ–∫–∏ –ø—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ –Ω–∞—à–æ–≥–æ Telegram-–∫–∞–Ω–∞–ª—É, —â–æ–± –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–∏ –≤–∞–∂–ª–∏–≤—ñ –Ω–æ–≤–∏–Ω–∏ –ø—Ä–æ –≤—Å—Ç—É–ø:</p>
        <a href="https://t.me/your_channel" target="_blank" class="btn btn-primary">–ü–µ—Ä–µ–π—Ç–∏ –≤ Telegram</a>
      </div>
    </div>
  </main>

  <script>
    // ==== CONFIGURATION ====
    const USE_MOCKS = true; 
    const MIN_OPEN_ANSWER_LENGTH = 8;
    const ERROR_MESSAGE = '–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞. –°–ø—Ä–æ–±—É–π—Ç–µ –∑–Ω–æ–≤—É –∞–±–æ –∑–≤\'—è–∂—ñ—Ç—å—Å—è –∑ –Ω–∞—à–∏–º –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—ó: manager@medstudy.cz';

    // ==== APP-WIDE VARIABLES FOR CONTENT ====
    // NOTE FOR DEVELOPER: In a real app, this data will be fetched from external JSON files or an API.
    // For this self-contained demo, we are defining it directly here to fix the fetch() error in sandboxed environments.
    const QUESTION_BANK = {
      "student": {
        "grade_9": [
          { "type": "multiple-choice", "question": "–©–æ —Ç–æ–±—ñ –Ω–∞–π—Ü—ñ–∫–∞–≤—ñ—à–µ –≤–∏–≤—á–∞—Ç–∏?", "options": [ "–Ø–∫ –≤–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π —Å–≤—ñ—Ç —ñ –ø—Ä–∏—Ä–æ–¥–∞ (–±—ñ–æ–ª–æ–≥—ñ—è, —Ö—ñ–º—ñ—è)", "–Ø–∫ –ø—Ä–∞—Ü—é—é—Ç—å —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó —Ç–∞ –∫–æ–º–ø'—é—Ç–µ—Ä–∏ (—ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞, —Ñ—ñ–∑–∏–∫–∞)", "–Ø–∫ –≤–∑–∞—î–º–æ–¥—ñ—é—Ç—å –ª—é–¥–∏ —Ç–∞ —Å—É—Å–ø—ñ–ª—å—Å—Ç–≤–æ (—ñ—Å—Ç–æ—Ä—ñ—è, –º–æ–≤–∏, –ø—Ä–∞–≤–æ)", "–Ø–∫ –ø—Ä–∞—Ü—é—é—Ç—å –≥—Ä–æ—à—ñ —Ç–∞ –±—ñ–∑–Ω–µ—Å (–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞, –µ–∫–æ–Ω–æ–º—ñ–∫–∞)" ], "tags": [ ["NAT", "MED"], ["TECH"], ["HUM"], ["ECO", "TECH"] ] },
          { "type": "multiple-choice", "question": "–Ø–∫–∏–π —Ç–∏–ø –∑–∞–≤–¥–∞–Ω—å —Ç–æ–±—ñ –¥–æ –¥—É—à—ñ?", "options": [ "–î–æ–ø–æ–º–∞–≥–∞—Ç–∏ –ª—é–¥—è–º, –≤–∏—Ä—ñ—à—É–≤–∞—Ç–∏ —ó—Ö–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏", "–°—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ —â–æ—Å—å –Ω–æ–≤–µ: –ø—Ä–æ–≥—Ä–∞–º–∏, –º–µ—Ö–∞–Ω—ñ–∑–º–∏, –¥–∏–∑–∞–π–Ω", "–ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, –ø–∏—Å–∞—Ç–∏ —Ç–µ–∫—Å—Ç–∏, –≤–∏–≤—á–∞—Ç–∏ –º–æ–≤–∏", "–û—Ä–≥–∞–Ω—ñ–∑–æ–≤—É–≤–∞—Ç–∏ –ø—Ä–æ—Ü–µ—Å–∏, –∫–µ—Ä—É–≤–∞—Ç–∏ –∫–æ–º–∞–Ω–¥–æ—é, —Ä–∞—Ö—É–≤–∞—Ç–∏" ], "tags": [ ["MED", "HUM"], ["TECH"], ["HUM"], ["ECO"] ] },
          { "type": "open-ended", "question": "–£—è–≤–∏ —Å–≤–æ—é —Ä–æ–±–æ—Ç—É —á–µ—Ä–µ–∑ 10 —Ä–æ–∫—ñ–≤. –û–ø–∏—à–∏ –æ–¥–Ω–∏–º —Ä–µ—á–µ–Ω–Ω—è–º, —á–∏–º —Ç–∏ –∑–∞–π–º–∞—î—à—Å—è?" }
        ],
        "grade_11": [
          { "type": "multiple-choice", "question": "–Ø–∫–∏–π –Ω–∞–ø—Ä—è–º –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ –¥–æ —ñ—Å–ø–∏—Ç—ñ–≤ (–ó–ù–û/–ù–ú–¢) —Ç–æ–±—ñ –Ω–∞–π–±–ª–∏–∂—á–∏–π?", "options": [ "–ë—ñ–æ–ª–æ–≥—ñ—è —Ç–∞ —Ö—ñ–º—ñ—è", "–§—ñ–∑–∏–∫–∞ —Ç–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "–Ü—Å—Ç–æ—Ä—ñ—è —Ç–∞ —ñ–Ω–æ–∑–µ–º–Ω—ñ –º–æ–≤–∏", "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ —Ç–∞ –≥–µ–æ–≥—Ä–∞—Ñ—ñ—è/–∞–Ω–≥–ª—ñ–π—Å—å–∫–∞" ], "tags": [ ["MED", "NAT"], ["TECH"], ["HUM"], ["ECO"] ] },
          { "type": "multiple-choice", "question": "–©–æ –¥–ª—è —Ç–µ–±–µ –Ω–∞–π–≤–∞–∂–ª–∏–≤—ñ—à–µ –≤ –º–∞–π–±—É—Ç–Ω—å–æ–º—É —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—ñ?", "options": [ "–ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø—Ä–µ—Å—Ç–∏–∂–Ω–∏–π –¥–∏–ø–ª–æ–º", "–ú–∞–∫—Å–∏–º—É–º –ø—Ä–∞–∫—Ç–∏–∫–∏ —Ç–∞ —Å—Ç–∞–∂—É–≤–∞–Ω—å –ø—ñ–¥ —á–∞—Å –Ω–∞–≤—á–∞–Ω–Ω—è", "–°–∏–ª—å–Ω–∞ –Ω–∞—É–∫–æ–≤–∞ –±–∞–∑–∞ —Ç–∞ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –∑–∞–π–º–∞—Ç–∏—Å—è –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è–º–∏", "–î–æ—Å—Ç—É–ø–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å –Ω–∞–≤—á–∞–Ω–Ω—è —Ç–∞ –∂–∏—Ç—Ç—è –≤ –º—ñ—Å—Ç—ñ" ], "tags": [ ["HUM"], ["TECH", "ECO"], ["MED", "NAT"], [] ] },
          { "type": "open-ended", "question": "–Ø–∫–∞ —Ç–≤–æ—è –Ω–∞–π–±—ñ–ª—å—à–∞ –º–µ—Ç–∞ –ø—Ä–∏ –≤—Å—Ç—É–ø—ñ –¥–æ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—É –∑–∞ –∫–æ—Ä–¥–æ–Ω–æ–º?" }
        ],
        "bachelor": [
          { "type": "multiple-choice", "question": "–©–æ —î –≥–æ–ª–æ–≤–Ω–æ—é –º–µ—Ç–æ—é –≤–∞—à–æ–≥–æ –≤—Å—Ç—É–ø—É –¥–æ –º–∞–≥—ñ—Å—Ç—Ä–∞—Ç—É—Ä–∏?", "options": [ "–ü–æ–≥–ª–∏–±–∏—Ç–∏ –∑–Ω–∞–Ω–Ω—è —É —Å–≤–æ—ó–π —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—Å—Ç—ñ –¥–ª—è –∫–∞—Ä'—î—Ä–Ω–æ–≥–æ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è", "–ó–º—ñ–Ω–∏—Ç–∏ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ—Å—Ç—å –Ω–∞ –±—ñ–ª—å—à –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—É", "–û—Ç—Ä–∏–º–∞—Ç–∏ —î–≤—Ä–æ–ø–µ–π—Å—å–∫–∏–π –¥–∏–ø–ª–æ–º –¥–ª—è —Ä–æ–±–æ—Ç–∏ –≤ –Ñ–°", "–ó–∞–π–Ω—è—Ç–∏—Å—è –Ω–∞—É–∫–æ–≤–æ—é –¥—ñ—è–ª—å–Ω—ñ—Å—Ç—é, –≤—Å—Ç—É–ø–∏—Ç–∏ –Ω–∞ PhD" ], "tags": [ [], ["TECH", "ECO"], [], ["MED", "NAT"] ] },
          { "type": "multiple-choice", "question": "–Ø–∫–∏–π —Ñ–æ—Ä–º–∞—Ç –Ω–∞–≤—á–∞–Ω–Ω—è –≤–∞–º –±—ñ–ª—å—à–µ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å?", "options": [ "–ü—Ä–∞–∫—Ç–∏—á–Ω–∏–π, –∑ —Ñ–æ–∫—É—Å–æ–º –Ω–∞ –ø—Ä–æ—î–∫—Ç–∞—Ö —Ç–∞ —Å—Ç–∞–∂—É–≤–∞–Ω–Ω—è—Ö", "–ê–∫–∞–¥–µ–º—ñ—á–Ω–∏–π, –∑ –ø–æ–≥–ª–∏–±–ª–µ–Ω–æ—é —Ç–µ–æ—Ä—ñ—î—é —Ç–∞ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è–º–∏", "–ö–æ–º–±—ñ–Ω–æ–≤–∞–Ω–∏–π, –∑–±–∞–ª–∞–Ω—Å–æ–≤–∞–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç", "–í–µ—á—ñ—Ä–Ω—ñ–π –∞–±–æ –∑–∞–æ—á–Ω–∏–π, —â–æ–± –ø–æ—î–¥–Ω—É–≤–∞—Ç–∏ –∑ —Ä–æ–±–æ—Ç–æ—é" ], "tags": [ ["TECH", "ECO"], ["MED", "NAT"], [], [] ] },
          { "type": "open-ended", "question": "–û–ø–∏—à—ñ—Ç—å –∫–æ—Ä–æ—Ç–∫–æ –≤–∞—à –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –¥–æ—Å–≤—ñ–¥ (–æ—Å–≤—ñ—Ç–∞, —Ä–æ–±–æ—Ç–∞) —Ç–∞ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è –≤—ñ–¥ –º–∞–≥—ñ—Å—Ç–µ—Ä—Å—å–∫–æ—ó –ø—Ä–æ–≥—Ä–∞–º–∏." }
        ],
        "undecided": [
          { "type": "multiple-choice", "question": "–Ø–∫–∏–π —ñ–∑ —Ü–∏—Ö –≤–∏–¥—ñ–≤ –¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ –ø—Ä–∏–≤–∞–±–ª—é—î —Ç–µ–±–µ –Ω–∞–π–±—ñ–ª—å—à–µ?", "options": [ "–î–æ–ø–æ–º–∞–≥–∞—Ç–∏ —Ç–∞ –ª—ñ–∫—É–≤–∞—Ç–∏", "–í–∏–Ω–∞—Ö–æ–¥–∏—Ç–∏ —Ç–∞ –±—É–¥—É–≤–∞—Ç–∏", "–°–ø—ñ–ª–∫—É–≤–∞—Ç–∏—Å—è —Ç–∞ –¥–æ–º–æ–≤–ª—è—Ç–∏—Å—è", "–ê–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ —Ç–∞ —Ä–∞—Ö—É–≤–∞—Ç–∏" ], "tags": [ ["MED", "NAT"], ["TECH"], ["HUM"], ["ECO"] ] },
          { "type": "multiple-choice", "question": "–©–æ –¥–ª—è —Ç–µ–±–µ –≤–∞–∂–ª–∏–≤—ñ—à–µ –≤ —Ä–æ–±–æ—Ç—ñ?", "options": [ "–°—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å —Ç–∞ —Å–æ—Ü—ñ–∞–ª—å–Ω–∞ –∑–Ω–∞—á—É—â—ñ—Å—Ç—å", "–í–∏—Å–æ–∫–∏–π –¥–æ—Ö—ñ–¥ —Ç–∞ –∫–∞—Ä'—î—Ä–Ω–µ –∑—Ä–æ—Å—Ç–∞–Ω–Ω—è", "–¢–≤–æ—Ä—á—ñ—Å—Ç—å —Ç–∞ —Å–∞–º–æ–≤–∏—Ä–∞–∂–µ–Ω–Ω—è", "–ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –ø–æ—Å—Ç—ñ–π–Ω–æ –≤—á–∏—Ç–∏—Å—è –Ω–æ–≤–æ–º—É" ], "tags": [ ["MED", "HUM"], ["ECO"], ["HUM"], ["TECH", "NAT"] ] },
          { "type": "open-ended", "question": "–Ø–∫–±–∏ –≤ —Ç–µ–±–µ –±—É–ª–∞ –±—É–¥—å-—è–∫–∞ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å, —è–∫—É –æ–¥–Ω—É –ø—Ä–æ–±–ª–µ–º—É —É —Å–≤—ñ—Ç—ñ —Ç–∏ –± —Ö–æ—Ç—ñ–≤(–ª–∞) –≤–∏—Ä—ñ—à–∏—Ç–∏?" }
        ]
      },
      "parent": {
        "all": [
          { "type": "multiple-choice", "question": "–©–æ –¥–ª—è –≤–∞—Å —î –≥–æ–ª–æ–≤–Ω–∏–º –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–æ–º –ø—Ä–∏ –≤–∏–±–æ—Ä—ñ –æ—Å–≤—ñ—Ç–∏ –¥–ª—è –¥–∏—Ç–∏–Ω–∏?", "options": [ "–ì–∞—Ä–∞–Ω—Ç–æ–≤–∞–Ω–µ –ø—Ä–∞—Ü–µ–≤–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ø—ñ—Å–ª—è –≤–∏–ø—É—Å–∫—É", "–ü—Ä–µ—Å—Ç–∏–∂ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—É —Ç–∞ —è–∫—ñ—Å—Ç—å –æ—Å–≤—ñ—Ç–∏", "–ë–µ–∑–ø–µ–∫–∞ —Ç–∞ –∫–æ–º—Ñ–æ—Ä—Ç –ø—Ä–æ–∂–∏–≤–∞–Ω–Ω—è –≤ –∫—Ä–∞—ó–Ω—ñ", "–ú—ñ–Ω—ñ–º–∞–ª—å–Ω—ñ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤—ñ –≤–∏—Ç—Ä–∞—Ç–∏ –Ω–∞ –Ω–∞–≤—á–∞–Ω–Ω—è —Ç–∞ –∂–∏—Ç—Ç—è" ], "tags": [ ["TECH", "ECO"], ["HUM", "MED"], [], [] ] },
          { "type": "multiple-choice", "question": "–Ø–∫–∏–π —ñ–∑ —Ü–∏—Ö —Ç–∞–ª–∞–Ω—Ç—ñ–≤ –Ω–∞–π—è—Å–∫—Ä–∞–≤—ñ—à–µ –≤–∏—Ä–∞–∂–µ–Ω–∏–π —É –≤–∞—à–æ—ó –¥–∏—Ç–∏–Ω–∏?", "options": [ "–ï–º–ø–∞—Ç—ñ—è —Ç–∞ –±–∞–∂–∞–Ω–Ω—è –¥–æ–ø–æ–º–∞–≥–∞—Ç–∏ —ñ–Ω—à–∏–º", "–õ–æ–≥—ñ—á–Ω–µ –º–∏—Å–ª–µ–Ω–Ω—è —Ç–∞ –ª—é–±–æ–≤ –¥–æ —Ç–µ—Ö–Ω—ñ–∫–∏", "–ö–æ–º—É–Ω—ñ–∫–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å —Ç–∞ –≥—É–º–∞–Ω—ñ—Ç–∞—Ä–Ω–∏–π —Å–∫–ª–∞–¥ —Ä–æ–∑—É–º—É", "–ê–Ω–∞–ª—ñ—Ç–∏—á–Ω—ñ –∑–¥—ñ–±–Ω–æ—Å—Ç—ñ —Ç–∞ —ñ–Ω—Ç–µ—Ä–µ—Å –¥–æ –±—ñ–∑–Ω–µ—Å—É" ], "tags": [ ["MED", "HUM"], ["TECH"], ["HUM"], ["ECO"] ] },
          { "type": "open-ended", "question": "–©–æ —î –≤–∞—à–∏–º –Ω–∞–π–±—ñ–ª—å—à–∏–º –∑–∞–Ω–µ–ø–æ–∫–æ—î–Ω–Ω—è–º —â–æ–¥–æ –≤—Å—Ç—É–ø—É –¥–∏—Ç–∏–Ω–∏ –∑–∞ –∫–æ—Ä–¥–æ–Ω?" }
        ]
      }
    };
    const PROMPTS = {
      "reportGeneration": {
        "common": {
          "persona": "–¢–∏ ‚Äî –ø—Ä–æ–≤—ñ–¥–Ω–∏–π –µ–∫—Å–ø–µ—Ä—Ç –∑ –æ—Å–≤—ñ—Ç–∏ –≤ –ß–µ—Ö—ñ—ó —Ç–∞ –∫–∞—Ä'—î—Ä–Ω–∏–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –∫–æ–º–ø–∞–Ω—ñ—ó MedStudy.cz. –¢–≤—ñ–π —Å—Ç–∏–ª—å ‚Äî –¥—Ä—É–∂–Ω—ñ–π, –ø—ñ–¥—Ç—Ä–∏–º—É—é—á–∏–π, –∞–ª–µ –¥—É–∂–µ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π. –¢–∏ –Ω–µ –ø—Ä–æ—Å—Ç–æ –¥–∞—î—à —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, –∞ —Ä–æ–∑–≤—ñ—é—î—à —Å—É–º–Ω—ñ–≤–∏ —Ç–∞ –Ω–∞–¥–∏—Ö–∞—î—à –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –∫—Ä–æ–∫. –¢–≤–æ—è –º–µ—Ç–∞ ‚Äî –ø–æ–∫–∞–∑–∞—Ç–∏, —â–æ MedStudy.cz —î –Ω–∞–¥—ñ–π–Ω–∏–º –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º –Ω–∞ –≤—Å—å–æ–º—É —à–ª—è—Ö—É –≤—Å—Ç—É–ø—É.",
          "cta": "3. –ó–∞–≤–µ—Ä—à—É–≤–∞—Ç–∏—Å—è —á—ñ—Ç–∫–∏–º –∑–∞–∫–ª–∏–∫–æ–º –¥–æ –¥—ñ—ó. –û–±–æ–≤'—è–∑–∫–æ–≤–æ –¥–æ–¥–∞–π –≤ –∫—ñ–Ω—Ü—ñ –∑–≤—ñ—Ç—É –¥–≤—ñ –∫–Ω–æ–ø–∫–∏ —É —Ñ–æ—Ä–º–∞—Ç—ñ HTML: \n   - –ü–µ—Ä—à–∞ (–æ—Å–Ω–æ–≤–Ω–∞): `<a href='https://medstudy.cz/consultation' class='btn btn-primary'>–ó–∞–ø–∏—Å–∞—Ç–∏—Å—è –Ω–∞ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω—É –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é</a>`\n   - –î—Ä—É–≥–∞: `<a href='https://medstudy.cz/guides/{topDirection}' class='btn btn-secondary'>–û—Ç—Ä–∏–º–∞—Ç–∏ –≥–∞–π–¥ –∑–∞ {topDirection} –Ω–∞–ø—Ä—è–º–æ–º</a>`"
        },
        "student_grade_9": {
          "context": "–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π –¥–∞–Ω—ñ –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: –†–æ–ª—å: –£—á–µ–Ω—å 9 –∫–ª–∞—Å—É. –ë–∞–∂–∞–Ω–∞ –º–æ–≤–∞ –Ω–∞–≤—á–∞–Ω–Ω—è: {languagePreference}. –ù–∞ –æ—Å–Ω–æ–≤—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π, –π–æ–≥–æ –æ—Å–Ω–æ–≤–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å ‚Äî {topDirection}. –û—Å—å –π–æ–≥–æ –∫–ª—é—á–æ–≤—ñ –¥—É–º–∫–∏ –∑ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –ø–∏—Ç–∞–Ω—å: {openAnswers}.",
          "task": "–°—Ç–≤–æ—Ä–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –∑–≤—ñ—Ç —É —Ñ–æ—Ä–º–∞—Ç—ñ HTML. –ó–≤—ñ—Ç –ø–æ–≤–∏–Ω–µ–Ω:",
          "personalization": "1. –ó–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ —É—á–Ω—è –¥—Ä—É–∂–µ–ª—é–±–Ω–æ. –û–±–æ–≤'—è–∑–∫–æ–≤–æ –ø–æ—Å–∏–ª–∞–π—Å—è –Ω–∞ –π–æ–≥–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –ø—Ä–æ —Ä–æ–±–æ—Ç—É –º—Ä—ñ—ó, —â–æ–± –ø–æ–∫–∞–∑–∞—Ç–∏, —â–æ —Ç–∏ –π–æ–≥–æ –ø–æ—á—É–≤. –ù–∞–ø—Ä–∏–∫–ª–∞–¥: '–¢–∏ –Ω–∞–ø–∏—Å–∞–≤, —â–æ —Ç–≤–æ—è —ñ–¥–µ–∞–ª—å–Ω–∞ —Ä–æ–±–æ—Ç–∞ ‚Äî –¥–æ–ø–æ–º–∞–≥–∞—Ç–∏ —Ç–≤–∞—Ä–∏–Ω–∞–º. –¶–µ —á—É–¥–æ–≤–æ! –î–∞–≤–∞–π –ø–æ–¥–∏–≤–∏–º–æ—Å—è, —è–∫ –¥–æ —Ü—å–æ–≥–æ –ø—Ä–∏–π—Ç–∏'.",
          "structure": "2. –ß—ñ—Ç–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É–≤–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é: \n   - `<h2>–¢–≤—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å —Ç–∞ —Å—É–ø–µ—Ä—Å–∏–ª–∏</h2>`: –ö–æ—Ä–æ—Ç–∫–∏–π –≤–∏—Å–Ω–æ–≤–æ–∫ –ø—Ä–æ –π–æ–≥–æ —Ç–∞–ª–∞–Ω—Ç–∏.\n   - `<h3>–Ø–∫—ñ –Ω–∞–ø—Ä—è–º–∏ —Ç–æ–±—ñ –ø—ñ–¥—ñ–π–¥—É—Ç—å?</h3>`: 2-3 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—Å—Ç—ñ.\n   - `<h3>–¢–æ–ø-3 —à–∫–æ–ª–∏/–≥—ñ–º–Ω–∞–∑—ñ—ó –¥–ª—è —Ç–µ–±–µ</h3>`: –°–ø–∏—Å–æ–∫ –∑ 3 –Ω–∞–≤—á–∞–ª—å–Ω–∏—Ö –∑–∞–∫–ª–∞–¥—ñ–≤.",
          "knowledgeBase": "–í–ê–ñ–õ–ò–í–û: –£—Å—ñ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—Å—Ç—ñ —Ç–∞ —à–∫–æ–ª–∏ –æ–±–∏—Ä–∞–π –°–£–í–û–†–û –∑ —Ü—å–æ–≥–æ —Å–ø–∏—Å–∫—É –¥–ª—è –Ω–∞–ø—Ä—è–º—É {topDirection}: [–¢—É—Ç –±—É–¥–µ —Å–ø–∏—Å–æ–∫ —à–∫—ñ–ª —Ç–∞ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—Å—Ç–µ–π –∑ –≤–∞—à–æ–≥–æ –≥–∞–π–¥—É –¥–ª—è 9 –∫–ª–∞—Å—É]"
        },
        "student_grade_11": {
          "context": "–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π –¥–∞–Ω—ñ –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: –†–æ–ª—å: –£—á–µ–Ω—å 11 –∫–ª–∞—Å—É. –ë–∞–∂–∞–Ω–∞ –º–æ–≤–∞ –Ω–∞–≤—á–∞–Ω–Ω—è: {languagePreference}. –ù–∞ –æ—Å–Ω–æ–≤—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π, –π–æ–≥–æ –æ—Å–Ω–æ–≤–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å ‚Äî {topDirection}. –û—Å—å –π–æ–≥–æ –∫–ª—é—á–æ–≤—ñ –¥—É–º–∫–∏ –∑ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –ø–∏—Ç–∞–Ω—å: {openAnswers}.",
          "task": "–°—Ç–≤–æ—Ä–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –∑–≤—ñ—Ç —É —Ñ–æ—Ä–º–∞—Ç—ñ HTML. –ó–≤—ñ—Ç –ø–æ–≤–∏–Ω–µ–Ω:",
          "personalization": "1. –ó–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –∞–±—ñ—Ç—É—Ä—ñ—î–Ω—Ç–∞ —è–∫ –¥–æ –º–∞–π–±—É—Ç–Ω—å–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞. –û–±–æ–≤'—è–∑–∫–æ–≤–æ –ø–æ—Å–∏–ª–∞–π—Å—è –Ω–∞ –π–æ–≥–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –ø—Ä–æ –≥–æ–ª–æ–≤–Ω—É –º–µ—Ç—É –≤—Å—Ç—É–ø—É. –ù–∞–ø—Ä–∏–∫–ª–∞–¥: '–¢–≤–æ—è –º–µ—Ç–∞ ‚Äî –æ—Ç—Ä–∏–º–∞—Ç–∏ –º–∞–∫—Å–∏–º—É–º –ø—Ä–∞–∫—Ç–∏–∫–∏. –¶–µ –¥—É–∂–µ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥, —ñ –≤ –ß–µ—Ö—ñ—ó —î –≤–∏—à—ñ, —è–∫—ñ —ñ–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ü—å–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—è—Ç—å'.",
          "structure": "2. –ß—ñ—Ç–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É–≤–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é: \n   - `<h2>–í–∞—à –ø—Ä–æ—Ñ—ñ–ª—å —Ç–∞ –∫–∞—Ä'—î—Ä–Ω—ñ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∏</h2>`: –ö–æ—Ä–æ—Ç–∫–∏–π –≤–∏—Å–Ω–æ–≤–æ–∫ –ø—Ä–æ –π–æ–≥–æ —Å–∏–ª—å–Ω—ñ —Å—Ç–æ—Ä–æ–Ω–∏.\n   - `<h3>–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—Å—Ç—ñ</h3>`: 2-3 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—Å—Ç—ñ.\n   - `<h3>–¢–æ–ø-3 —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç–∏ –¥–ª—è –≤–∞—Å</h3>`: –°–ø–∏—Å–æ–∫ –∑ 3 —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—ñ–≤ –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º–∏ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞–º–∏.",
          "knowledgeBase": "–í–ê–ñ–õ–ò–í–û: –£—Å—ñ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—Å—Ç—ñ —Ç–∞ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç–∏ –æ–±–∏—Ä–∞–π –°–£–í–û–†–û –∑ —Ü—å–æ–≥–æ —Å–ø–∏—Å–∫—É –¥–ª—è –Ω–∞–ø—Ä—è–º—É {topDirection}: [–¢—É—Ç –±—É–¥–µ —Å–ø–∏—Å–æ–∫ –≤–∏—à—ñ–≤ —Ç–∞ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—Å—Ç–µ–π –∑ –≤–∞—à–æ–≥–æ –≥–∞–π–¥—É –¥–ª—è 11 –∫–ª–∞—Å—É]"
        },
        "student_bachelor": {
          "context": "–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π –¥–∞–Ω—ñ –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: –†–æ–ª—å: –°—Ç—É–¥–µ–Ω—Ç/–≤–∏–ø—É—Å–∫–Ω–∏–∫ –±–∞–∫–∞–ª–∞–≤—Ä–∞—Ç—É. –ë–∞–∂–∞–Ω–∞ –º–æ–≤–∞ –Ω–∞–≤—á–∞–Ω–Ω—è: {languagePreference}. –ù–∞ –æ—Å–Ω–æ–≤—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π, –π–æ–≥–æ –æ—Å–Ω–æ–≤–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å ‚Äî {topDirection}. –û—Å—å –π–æ–≥–æ –∫–ª—é—á–æ–≤—ñ –¥—É–º–∫–∏ –∑ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –ø–∏—Ç–∞–Ω—å: {openAnswers}.",
          "task": "–°—Ç–≤–æ—Ä–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –∑–≤—ñ—Ç —É —Ñ–æ—Ä–º–∞—Ç—ñ HTML. –ó–≤—ñ—Ç –ø–æ–≤–∏–Ω–µ–Ω:",
          "personalization": "1. –ó–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —è–∫ –¥–æ –∫–æ–ª–µ–≥–∏, –Ω–∞ '–í–∏'. –û–±–æ–≤'—è–∑–∫–æ–≤–æ –ø–æ—Å–∏–ª–∞–π—Å—è –Ω–∞ –π–æ–≥–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –ø—Ä–æ –¥–æ—Å–≤—ñ–¥ —Ç–∞ –æ—á—ñ–∫—É–≤–∞–Ω–Ω—è. –ù–∞–ø—Ä–∏–∫–ª–∞–¥: '–í–∏—Ö–æ–¥—è—á–∏ –∑ –≤–∞—à–æ–≥–æ –¥–æ—Å–≤—ñ–¥—É –≤ [—Å—Ñ–µ—Ä–∞] —Ç–∞ –±–∞–∂–∞–Ω–Ω—è [–º–µ—Ç–∞], –º–∏ –º–æ–∂–µ–º–æ –ø–æ—Ä–µ–∫–æ–º–µ–Ω–¥—É–≤–∞—Ç–∏ –Ω–∞—Å—Ç—É–ø–Ω—ñ –º–∞–≥—ñ—Å—Ç–µ—Ä—Å—å–∫—ñ –ø—Ä–æ–≥—Ä–∞–º–∏...'",
          "structure": "2. –ß—ñ—Ç–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É–≤–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é: \n   - `<h2>–í–∞—à –∫–∞—Ä'—î—Ä–Ω–∏–π —Ç—Ä–µ–∫ —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó</h2>`: –ê–Ω–∞–ª—ñ–∑ –π–æ–≥–æ –±–µ–∫–≥—Ä–∞—É–Ω–¥—É.\n   - `<h3>–ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ñ –º–∞–≥—ñ—Å—Ç–µ—Ä—Å—å–∫—ñ –ø—Ä–æ–≥—Ä–∞–º–∏</h3>`: 2-3 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –ø—Ä–æ–≥—Ä–∞–º–∏.\n   - `<h3>–¢–æ–ø-3 —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç–∏ –¥–ª—è –º–∞–≥—ñ—Å—Ç—Ä–∞—Ç—É—Ä–∏</h3>`: –°–ø–∏—Å–æ–∫ –∑ 3 —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—ñ–≤ –∑ —Ñ–æ–∫—É—Å–æ–º –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫—É/–Ω–∞—É–∫—É –∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –π–æ–≥–æ —Ü—ñ–ª–µ–π.",
          "knowledgeBase": "–í–ê–ñ–õ–ò–í–û: –£—Å—ñ –º–∞–≥—ñ—Å—Ç–µ—Ä—Å—å–∫—ñ –ø—Ä–æ–≥—Ä–∞–º–∏ —Ç–∞ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç–∏ –æ–±–∏—Ä–∞–π –°–£–í–û–†–û –∑ —Ü—å–æ–≥–æ —Å–ø–∏—Å–∫—É –¥–ª—è –Ω–∞–ø—Ä—è–º—É {topDirection}: [–¢—É—Ç –±—É–¥–µ —Å–ø–∏—Å–æ–∫ –≤–∏—à—ñ–≤ —Ç–∞ –ø—Ä–æ–≥—Ä–∞–º –∑ –≤–∞—à–æ–≥–æ –≥–∞–π–¥—É –¥–ª—è –±–∞–∫–∞–ª–∞–≤—Ä—ñ–≤]"
        },
        "parent": {
          "context": "–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π –¥–∞–Ω—ñ –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: –†–æ–ª—å: –û–¥–∏–Ω –∑ –±–∞—Ç—å–∫—ñ–≤. –†—ñ–≤–µ–Ω—å –æ—Å–≤—ñ—Ç–∏ –¥–∏—Ç–∏–Ω–∏: {educationLevel}. –ë–∞–∂–∞–Ω–∞ –º–æ–≤–∞ –Ω–∞–≤—á–∞–Ω–Ω—è: {languagePreference}. –ù–∞ –æ—Å–Ω–æ–≤—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π, –æ—Å–Ω–æ–≤–Ω–∏–π –ø—Ä–æ—Ñ—ñ–ª—å ‚Äî {topDirection}. –û—Å—å –π–æ–≥–æ –∫–ª—é—á–æ–≤—ñ –¥—É–º–∫–∏ –∑ –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –ø–∏—Ç–∞–Ω—å: {openAnswers}.",
          "task": "–°—Ç–≤–æ—Ä–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –∑–≤—ñ—Ç —É —Ñ–æ—Ä–º–∞—Ç—ñ HTML. –ó–≤—ñ—Ç –ø–æ–≤–∏–Ω–µ–Ω:",
          "personalization": "1. –ó–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –±–∞—Ç—å–∫—ñ–≤ —à–∞–Ω–æ–±–ª–∏–≤–æ —Ç–∞ –ø–æ-–¥—ñ–ª–æ–≤–æ–º—É. –û–±–æ–≤'—è–∑–∫–æ–≤–æ –ø–æ—Å–∏–ª–∞–π—Å—è –Ω–∞ —ó—Ö–Ω—é –≤—ñ–¥–ø–æ–≤—ñ–¥—å –ø—Ä–æ –≥–æ–ª–æ–≤–Ω–µ –∑–∞–Ω–µ–ø–æ–∫–æ—î–Ω–Ω—è. –ù–∞–ø—Ä–∏–∫–ª–∞–¥: '–í–∏ –∑–≥–∞–¥–∞–ª–∏, —â–æ –Ω–∞–π–±—ñ–ª—å—à–µ —Ç—É—Ä–±—É—î—Ç–µ—Å—è –ø—Ä–æ –±–µ–∑–ø–µ–∫—É. –ú–∏ –≤ MedStudy.cz –ø–æ–≤–Ω—ñ—Å—Ç—é –ø–æ–¥—ñ–ª—è—î–º–æ –≤–∞—à—É –ø–æ–∑–∏—Ü—ñ—é —ñ –ø—Ä–æ–ø–æ–Ω—É—î–º–æ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç–∏ —Ç—ñ–ª—å–∫–∏ –≤ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–∏—Ö —ñ –±–µ–∑–ø–µ—á–Ω–∏—Ö –º—ñ—Å—Ç–∞—Ö...'",
          "structure": "2. –ß—ñ—Ç–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä—É–≤–∞—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é: \n   - `<h2>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è –≤–∞—à–æ—ó –¥–∏—Ç–∏–Ω–∏</h2>`: –ö–æ—Ä–æ—Ç–∫–∏–π –∞–Ω–∞–ª—ñ–∑ –ø—Ä–æ—Ñ—ñ–ª—é.\n   - `<h3>–ü–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω—ñ –Ω–∞–ø—Ä—è–º–∏ –Ω–∞–≤—á–∞–Ω–Ω—è</h3>`: 2-3 —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—Å—Ç—ñ.\n   - `<h3>–¢–æ–ø-3 –Ω–∞–¥—ñ–π–Ω–∏—Ö —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç–∏</h3>`: –°–ø–∏—Å–æ–∫ –∑ 3 —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—ñ–≤ –∑ –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –±–µ–∑–ø–µ–∫—É, —è–∫—ñ—Å—Ç—å —Ç–∞ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–∏ –ø—Ä–∞—Ü–µ–≤–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è.",
          "knowledgeBase": "–í–ê–ñ–õ–ò–í–û: –£—Å—ñ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—Å—Ç—ñ —Ç–∞ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç–∏ –æ–±–∏—Ä–∞–π –°–£–í–û–†–û –∑ —Ü—å–æ–≥–æ —Å–ø–∏—Å–∫—É –¥–ª—è –Ω–∞–ø—Ä—è–º—É {topDirection}: [–¢—É—Ç –±—É–¥–µ —Å–ø–∏—Å–æ–∫ –≤–∏—à—ñ–≤ —Ç–∞ —Å–ø–µ—Ü—ñ–∞–ª—å–Ω–æ—Å—Ç–µ–π –∑ –≤–∞—à–∏—Ö –≥–∞–π–¥—ñ–≤]"
        }
      },
      "DIR_LABELS": {
        "MED": "–ú–µ–¥–∏—á–Ω–∏–π",
        "TECH": "–¢–µ—Ö–Ω—ñ—á–Ω–∏–π",
        "HUM": "–ì—É–º–∞–Ω—ñ—Ç–∞—Ä–Ω–∏–π",
        "ECO": "–ï–∫–æ–Ω–æ–º—ñ—á–Ω–∏–π",
        "NAT": "–ü—Ä–∏—Ä–æ–¥–Ω–∏—á–æ-–Ω–∞—É–∫–æ–≤–∏–π"
      }
    };

    // ==== UI Elements ====
    const containers = {
        start: document.getElementById('start-container'),
        roleSelection: document.getElementById('role-selection-container'),
        educationLevel: document.getElementById('education-level-container'),
        languageSelection: document.getElementById('language-selection-container'),
        quiz: document.getElementById('quiz-container'),
        leadCapture: document.getElementById('lead-capture-container'),
        thankYou: document.getElementById('thank-you-container'),
    };
    const startTestBtn = document.getElementById('start-test-btn');
    const nextQuestionBtn = document.getElementById('next-question-btn');
    const leadForm = document.getElementById('lead-form');
    const formError = document.getElementById('form-error');
    const questionTextEl = document.getElementById('question-text');
    const optionsContainer = document.getElementById('options-container');
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');
    const previewWrap = document.getElementById('preview-wrap');
    const resultsPreview = document.getElementById('results-preview');

    // ==== State ====
    let userRole = '';
    let educationLevel = '';
    let languagePreference = '';
    let questions = [];
    let currentQuestionIndex = 0;
    let userAnswers = [];
    let lockClick = false;
    let careerResultsHtml = '';

    // ==== Scoring Logic ====
    // ... (Scoring functions remain the same) ...

    // ==== API Layer (Mocks & Logic) ====
    // ... (API functions remain the same) ...
    
    // ==== DataLayer for Analytics ====
    // ... (DataLayer function remains the same) ...

    // ==== Flow Control Functions ====
    // ... (Flow control functions remain the same) ...

    // ==== App Initialization ====
    function main() {
        try {
            // Content is now defined directly in the script, so no fetching is needed.
            appLoader.classList.add('hidden');
            showScreen('start');

            // Setup event listeners
            startTestBtn.addEventListener('click', () => {
                showScreen('roleSelection');
                pushToDataLayer('quiz_start', { user_role: 'unknown', education_level: 'unknown' });
            });
            containers.roleSelection.addEventListener('click', (e) => {
                const role = e.target.closest('button')?.dataset.role;
                if (role) { userRole = role; showScreen('educationLevel'); }
            });
            containers.educationLevel.addEventListener('click', (e) => {
                const level = e.target.closest('button')?.dataset.level;
                if (level) { educationLevel = level; showScreen('languageSelection'); }
            });
            containers.languageSelection.addEventListener('click', (e) => {
                const lang = e.target.closest('button')?.dataset.lang;
                if (lang) { languagePreference = lang; startQuizFlow(); }
            });
            nextQuestionBtn.addEventListener('click', handleNextQuestion);
            leadForm.addEventListener('submit', handleFormSubmit);

        } catch (error) {
            console.error("Initialization failed:", error);
            appLoader.parentElement.innerHTML = `<p class="text-red-500">${ERROR_MESSAGE}</p>`;
        }
    }
    
    // All helper functions (resetScores, applyTagScores, apiGenerateReport, etc.) are placed here
    // to keep the main logic readable.
    
    function resetScores(){ scores = { MED:0, TECH:0, HUM:0, ECO:0, NAT:0 }; }
    function applyTagScores(tagList){ if(!Array.isArray(tagList)) return; tagList.forEach(t => { if(SCORE_WEIGHTS[t] != null) scores[t] += SCORE_WEIGHTS[t]; }); }
    function applyKeywordScores(text){ const t=(text||'').toLowerCase(); for(const dir in KEYWORD_MAP){ if(KEYWORD_MAP[dir].some(k=>t.includes(k))) scores[dir]+=1; } }
    function getTopDirection(){ let best='TECH',v=-Infinity; for(const k in scores){ if(scores[k]>v){v=scores[k];best=k;} } return best; }

    async function apiGenerateReport() {
        if(USE_MOCKS){
            const topDir = getTopDirection();
            const topDirLabel = PROMPTS.DIR_LABELS[topDir] || '–¢–µ—Ö–Ω—ñ—á–Ω–∏–π';
            
            const promptConfigKey = userRole === 'parent' ? 'parent' : `student_${educationLevel}`;
            const promptConfig = PROMPTS.reportGeneration[promptConfigKey] || PROMPTS.reportGeneration.student_grade_11; // Fallback
            const openAnswersText = userAnswers
                .filter(a => a.type === 'open-ended')
                .map(a => `Q: ${a.question}\nA: ${a.answer}`)
                .join('\n');

            let prompt = `${PROMPTS.reportGeneration.common.persona} ${promptConfig.context} ${promptConfig.task} ${promptConfig.personalization} ${promptConfig.structure} ${promptConfig.knowledgeBase} ${PROMPTS.reportGeneration.common.cta}`;
            prompt = prompt.replace(/{userRole}/g, userRole)
                           .replace(/{educationLevel}/g, educationLevel)
                           .replace(/{languagePreference}/g, languagePreference)
                           .replace(/{topDirection}/g, topDirLabel)
                           .replace(/{openAnswers}/g, openAnswersText);
            
            console.log("GENERATING REPORT WITH PROMPT:", prompt);
            await new Promise(r => setTimeout(r, 800));
            return `
                <h2>–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∏–π –∑–≤—ñ—Ç</h2>
                <p>–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞–≤—à–∏ –≤–∞—à—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ, –º–∏ –≤–∏–∑–Ω–∞—á–∏–ª–∏, —â–æ –≤–∞–º –Ω–∞–π–±—ñ–ª—å—à–µ –ø—ñ–¥—Ö–æ–¥–∏—Ç—å <b>${topDirLabel} –Ω–∞–ø—Ä—è–º</b>.</p>
                <h3>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó</h3>
                <p>–ù–∞ –æ—Å–Ω–æ–≤—ñ –≤–∞—à–∏—Ö –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π, AI —Ä–µ–∫–æ–º–µ–Ω–¥—É—î –∑–≤–µ—Ä–Ω—É—Ç–∏ —É–≤–∞–≥—É –Ω–∞...</p>
                <br>
                <a href="#" class="btn btn-primary" style="display:block; text-align:center; margin-bottom:1rem;">–ó–∞–ø–∏—Å–∞—Ç–∏—Å—è –Ω–∞ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω—É –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü—ñ—é</a>
                <a href="#" class="btn btn-secondary" style="display:block; text-align:center;">–û—Ç—Ä–∏–º–∞—Ç–∏ –≥–∞–π–¥ –∑–∞ –Ω–∞–ø—Ä—è–º–æ–º</a>
            `;
        }
    }

    async function apiSubmitLead(payload){
        if(USE_MOCKS){
            console.log("MOCK SUBMIT:", payload);
            await new Promise(r => setTimeout(r, 600));
            return { ok: true, leadId: 'DEMO-' + Date.now() };
        }
    }
    
    function pushToDataLayer(event, payload = {}) {
        if (typeof window.dataLayer !== 'undefined') {
            window.dataLayer.push({ event, ...payload });
        }
    }

    function showScreen(screenName) {
        appLoader.classList.add('hidden');
        Object.values(containers).forEach(c => c.classList.add('hidden'));
        if (containers[screenName]) {
            containers[screenName].classList.remove('hidden');
        }
    }

    function startQuizFlow() {
        resetScores();
        questions = (userRole === 'parent') 
            ? QUESTION_BANK.parent.all 
            : (QUESTION_BANK.student[educationLevel] || QUESTION_BANK.student.undecided);
        currentQuestionIndex = 0;
        userAnswers = [];
        progressBar.style.width = '0%';
        showScreen('quiz');
        displayQuestion();
    }

    function displayQuestion(){
        if(currentQuestionIndex < questions.length){
            const q = questions[currentQuestionIndex];
            questionTextEl.textContent = q.question;
            optionsContainer.innerHTML='';
            nextQuestionBtn.classList.add('hidden');
            if(q.type==='multiple-choice'){
                q.options.forEach((option, idx)=>{
                    const b=document.createElement('button');
                    b.textContent=option; b.className='quiz-option';
                    const tag = (q.tags && q.tags[idx]) || [];
                    b.onclick=()=> selectAnswer(q, option, tag);
                    optionsContainer.appendChild(b);
                });
            } else { // open-ended
                const ta = document.createElement('textarea');
                const hint = document.createElement('p');
                hint.className = 'input-hint hidden';
                ta.className='open-question-textarea'; ta.rows=4; ta.maxLength=240; ta.placeholder='–í–∞—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—å...';
                ta.addEventListener('input',()=>{ const isLongEnough = ta.value.trim().length >= MIN_OPEN_ANSWER_LENGTH; nextQuestionBtn.disabled = !isLongEnough; hint.classList.toggle('hidden', isLongEnough); });
                hint.textContent = `–ë—É–¥—å –ª–∞—Å–∫–∞, –¥–∞–π—Ç–µ –±—ñ–ª—å—à —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç—É –≤—ñ–¥–ø–æ–≤—ñ–¥—å (–º—ñ–Ω. ${MIN_OPEN_ANSWER_LENGTH} —Å–∏–º–≤–æ–ª—ñ–≤).`;
                optionsContainer.appendChild(ta); optionsContainer.appendChild(hint);
                nextQuestionBtn.classList.remove('hidden'); nextQuestionBtn.disabled = true;
            }
            progressText.textContent = `–ü–∏—Ç–∞–Ω–Ω—è ${currentQuestionIndex + 1} –∑ ${questions.length}`;
            const progress = ((currentQuestionIndex) / questions.length) * 100;
            progressBar.style.width = `${progress}%`;
        } else {
            progressBar.style.width='100%';
            finishQuiz();
        }
    }
    
    function handleNextQuestion(){
        const ta = optionsContainer.querySelector('textarea');
        if(ta && ta.value.trim().length >= MIN_OPEN_ANSWER_LENGTH){
            selectAnswer(questions[currentQuestionIndex], ta.value.trim(), []);
        }
    }
    
    function selectAnswer(qObj, answer, tags){
        if(lockClick) return;
        lockClick = true;
        if(qObj.type === 'multiple-choice'){ applyTagScores(tags); } 
        else { applyKeywordScores(answer); }
        userAnswers.push({ question: qObj.question, answer: answer, type: qObj.type });
        
        pushToDataLayer('quiz_step_complete', {
            step_number: currentQuestionIndex + 1,
            question_text: qObj.question
        });
        
        currentQuestionIndex++;
        setTimeout(()=>{ lockClick=false; displayQuestion(); }, 150);
    }
    
    async function finishQuiz(){
        showScreen('leadCapture');
        pushToDataLayer('quiz_complete');
        try {
            const html = await apiGenerateReport();
            careerResultsHtml = html || '';
            const clean = DOMPurify.sanitize(careerResultsHtml, {USE_PROFILES:{html:true}});
            if(clean){ resultsPreview.innerHTML = clean; previewWrap.classList.remove('hidden'); }
        } catch(err) { 
            console.error("Report generation failed:", err); 
            pushToDataLayer('generate_report_error', { error_message: err.message });
        }
    }
    
    async function handleFormSubmit(e){
        e.preventDefault();
        const submitBtn = document.getElementById('submit-lead-btn');
        const formLoader = document.getElementById('form-loader');
        submitBtn.classList.add('hidden'); formLoader.classList.remove('hidden'); formError.classList.add('hidden');
        
        const topDirection = getTopDirection();
        const payload = {
            name: document.getElementById('lead-name').value.trim(),
            email: document.getElementById('lead-email').value.trim(),
            phone: document.getElementById('lead-phone').value.trim(),
            social: document.getElementById('lead-social').value.trim(),
            userRole, educationLevel, languagePreference, scores,
            openAnswers: userAnswers.filter(a => a.type === 'open-ended'),
            testResults: careerResultsHtml,
        };
        
        pushToDataLayer('lead_submit', {
            user_role: userRole,
            education_level: educationLevel,
            top_direction: topDirection
        });
        
        try {
            await apiSubmitLead(payload);
            showScreen('thankYou');
        } catch(err) {
            console.error(err);
            formError.textContent = ERROR_MESSAGE;
            formError.classList.remove('hidden');
            submitBtn.classList.remove('hidden');
            formLoader.classList.add('hidden');
        }
    }

    main();
  </script>
</body>
</html>
